
<script type="text/javascript" src="view/templates/jslib/prototype/prototype.js"></script>
<script type="text/javascript" src="admin-js.php?tp=form&js=condominio"></script>
<script type="text/javascript" src="admin-js.php?tp=form&js=validacao"></script>
<script type="text/javascript" src="admin-js.php?tp=form&js=ajax"></script>

<script language="JavaScript">
// Lista
var planosBL=eval('{$listaBL}');
var planosD=eval('{$listaD}');
var planosH=eval('{$listaH}');

var BLSelecionado='';
var DSelecionado='';
var HSelecionado='';

var cortesia = false;

var LIMITE_PRORATA = {$limite_prorata};

var condominios = eval({$condominios});
var condominios_instalacao = eval({$condominios_instalacao});

//window.alert(validaUsernameString);


var enviando = false;


{literal}

function alteraNas() {
	var frm = document.contratacao;
	if( frm.id_nas.value != frm.nas_orig.value ) {
		document.getElementById('selecao_redeip').value = "A";
		alteraSelecaoIP();
	}
}

function alteraSelecaoIP() {
	var frm = document.contratacao;
	if( frm.selecao_redeip.value == "A" ) {
		desabilita(frm.endereco_redeip);
		frm.endereco_redeip.value = "";
	} else {
		habilita(frm.endereco_redeip);
	}
}

returnStatusEmail = false;
function validaEmail(username,dominio){
	var username = document.getElementById('username');
	var dominio = {/literal}'{$preferenciasGerais.dominio_padrao}'{literal}
	var url = "admin-ajax.php";
	var pars = "op=contas&output=JSON&query=email&username="+username+"&dominio="+dominio;

	var myAjax = new Ajax.Request(
		url,
		{
			method: 'get',
			parameters: pars,
			onComplete: showResponseEmail,
			asynchronous: false
		});
	return 	returnStatusEmail;
}

function showResponseEmail(originalRequest) {
	if ( !getReturn(originalRequest.responseText)){
		document.getElementById('criar_email').checked = false;
		returnStatusEmail = false;
	} else {
		returnStatusEmail = true;
	}
}

returnStatusUsername = false;

function validaFormatoUsername() {


	window.alert("VALIDA FORMATO USERNAME");




	return(false);
}


function validaUsername(){
	username = document.getElementById('username').value;
	dominio = {/literal}'{$preferenciasGerais.dominio_padrao}'{literal}
	tipo = document.getElementById('tipo').value;
	var url = "admin-ajax.php";
	var pars = "op=contas&output=JSON&query=usuario&username="+username+"&dominio="+dominio+"&tipo_conta="+tipo;

	var myAjax = new Ajax.Request(
		url,
		{
			method: 'get',
			parameters: pars,
			onComplete: showResponseUsername,
			asynchronous: false
		});


	return 	returnStatusUsername;
}


function showResponseUsername(originalRequest) {
	if ( !getReturn(originalRequest.responseText)){
		// document.getElementById('username').value = "";
		if( document.getElementById('username').enabled ) {
			document.getElementById('username').focus();
		}
		returnStatusUsername = false;
	} else {
		returnStatusUsername = true;
	}
}

returnStatus = false;
function checkEnderecoDisponivel(id_nas, endereco){
	var url = "admin-ajax.php";
	var pars = "op=contas&output=JSON&query=enderecoDisponivel&id_nas="+id_nas+"&endereco="+endereco;

	var myAjax = new Ajax.Request(
		url,
		{
			method: 'get',
			parameters: pars,
			onComplete: showResponse,
			asynchronous: false
		});

	return returnStatus;
}

function chopTrim(str) {

	str = str.replace(/^\s+|\s+$|\x1C|\n/g,"");

	return(str);
}


function getReturn(response){
	response = chopTrim(response);
	var r;
	try {
		var tmp = "r = " + response + ";";
		eval(tmp);
	} catch(e) {
		// window.alert("ERR: " + e.message + " / Contacte o suporte");
		try {
			r = response.evalJSon();
		} catch(e) {
			window.alert("ERR: " + e.message + " / Contacte o suporte");
		}
	}

	if(r.codigo > 0){
		// alert(r.mensagem)
		return false;
	}

	return r;
}

function showResponse(originalRequest) {
	r = getReturn(originalRequest.responseText);
	if(r == false){
		returnStatus = false;
	} else {
		returnStatus = true;
		document.getElementById('endereco_redeip').value = r.endereco;
	}
}

function Cancelar() {
	if(window.confirm("Deseja abandonar esta contratação?")) {
		{/literal}
		window.open("admin-clientes.php?op=contrato&id_cliente={$id_cliente}","_self");
		{literal}
	}
	return false;
}

function contratoObtemPlano(tipo,id_produto) {



	var lista = null;

	if(tipo == "BL") {
		lista = planosBL;
	}

	if( tipo == "D") {
		lista = planosD;
	}

	if( tipo == "H") {
		lista = planosH;
	}

	if( lista != null && lista != undefined) {
		for(i=0;i<lista.length;i++) {

			if( lista[i].id_produto == id_produto ) {
				return lista[i];
			}
		}
	}

	return null;
}

function contratoEscondeBox(tipo) {
	var frm = document.contratacao;

	if( frm.id_cliente_produto.value != '' ) {
		return;
	}

	if( tipo == null || tipo == undefined || tipo == "" ){
		contratoEscondeBox("BL");
		contratoEscondeBox("D");
		contratoEscondeBox("H");
		contratoEscondeBox("EI");
	}
	var container = document.getElementById("box"+tipo);

	if( container != null && container != undefined ) {
		var target = document.getElementById("boxTarget");
		var temp   = document.getElementById("boxTemporaria");
		container.style.display = "none";
		container.style.position = "static";
		container.style.size="0px";
		temp.appendChild(container);
	}
}

function contratoExibeBox(tipo) {
	var frm = document.contratacao;

	if( frm.id_cliente_produto.value != '' ) {
		return;
	}



	contratoEscondeBox("BL");
	contratoEscondeBox("D");
	contratoEscondeBox("H");
	contratoEscondeBox("EI");

	var container = document.getElementById("box"+tipo);
	if( container != null && container != undefined ) {
		container.style.display = "block";
		var target = document.getElementById("boxTarget");
		target.appendChild(container);

		container.style.position = "static";
		container.style.size="";

		//ser for BANDA LARGA OU DISCADA add ENDERECO DE INSTALACAO
		if (tipo == "BL" || tipo == "D") {
		  containerEI = document.getElementById("boxEI");
		  containerEI.style.display = "block";
		  containerEI.style.position = "static"
		  target.appendChild(containerEI);
		}
	}

	contratoDependenciasBox(tipo);

}

function contratoDependenciasBox(tipo) {
	var frm = document.contratacao;

	if( frm.id_cliente_produto.value != '' ) {
		return;
	}

	if( tipo == "BL" ) {
		if( frm.username.disabled || frm.username.value == "" ) {
			desabilita(frm.id_nas);
			desabilita(frm.id_pop);
			desabilita(frm.selecao_redeip);
			desabilita(frm.mac);
		} else {
			habilita(frm.id_nas);
			habilita(frm.id_pop);
			habilita(frm.selecao_redeip);
			habilita(frm.mac);
		}

		contratoAlteraEndereco();
	}

	if( tipo == "D" ) {
		if( frm.username.disabled || frm.username.value == "" ) {
			desabilita(frm.foneinfo);
		} else {
			habilita(frm.foneinfo);
		}
	}

	if( tipo == "H" ) {
		if( frm.username.disabled || frm.username.value == "" ) {
			desabilita(frm.tipo_hospedagem);
		} else {
			habilita(frm.tipo_hospedagem);
		}
		contratoAlteraTipoHospedagem();
	}

}

function contratoAlteraUsername() {
	var frm = document.contratacao;
	contratoDependenciasBox(frm.tipo.value);
}

function contratoAlteraTipoHospedagem() {
	var frm = document.contratacao;

	if( frm.tipo_hospedagem.disabled || frm.tipo_hospedagem.value == "" || frm.tipo_hospedagem.value == "U") {
		desabilita(frm.dominio_hospedagem);
	} else {
		habilita(frm.dominio_hospedagem);
	}
}


function contratoPopulaProdutos(tipo) {
	var frm=document.contratacao;
	var option_index = 0;
	frm.id_produto.value="";

	frm.id_produto.width="100 px";

	for(i=frm.id_produto.options.length;i>0;--i) {
		frm.id_produto.remove(0);
	}

	var e =  document.getElementById("id_produto");
	e.options[option_index] = new Option("-- SELECIONE --","");

	/*o = document.createElement("OPTION");
	o.value = "";
	o.innerText = "-- SELECIONE --";*/

	//frm.id_produto.appendChild(o);

	if( frm.tipo.value == '' ) {
		contratoEscondeBox();
		desabilita(frm.id_produto);
	} else {
		habilita(frm.id_produto);
		contratoExibeBox(tipo);

		if( frm.tipo.value == 'BL' ) {
			lista = planosBL;
		}

		if( frm.tipo.value == 'D' ) {
			lista = planosD;
		}

		if( frm.tipo.value == 'H' ) {
			lista = planosH;
		}

		if( lista != null && lista != undefined ) {
			for(i=0;i<lista.length;i++) {

				//o = document.createElement("OPTION");
				//o.value = lista[i].id_produto;
				vl = lista[i].valor;
				if( vl == 0 ) {
					vl = "cortesia";
				} else {
					vl = " R$ " + vl;
				}
				//o.innerText = lista[i].nome + " / " + vl;
				//frm.id_produto.appendChild(o);
				option_index++;

				var opcao = lista[i].nome + "|" + vl;
				//window.alert(lista[i].tipo);
				if( lista[i].tipo == 'BL' ) {
					var up = lista[i].banda_upload_kbps;
					var dn = lista[i].banda_download_kbps
					//window.alert("UP: " + up);
					//window.alert("DN: " + dn);

					if( up == '0' || up == '') {
						up = 'Ilim.';
					} else {
						// up += ' kbps';
					}

					if( dn == '0' || dn == '') {
						dn = 'Ilim.';
					} else {
						// dn += ' kbps';
					}

					opcao += '|U/D: ' + up + "/" + dn;
				}

				e.options[option_index] = new Option(opcao,lista[i].id_produto);
			}

		}
	}
}

function contratoAlteraTipo() {
	var frm=document.contratacao;
	contratoPopulaProdutos(frm.tipo.value);
	contratoAlteraProduto();
}

function setDisabledRadio(nome,disabled) {
	el = document.getElementsByTagName("input");
	for(i=0;i<el.length;i++) {
		if( el[i].type == "radio" && el[i].name == nome ) {
			el[i].disabled = disabled;
		}
	}
}

function getCheckedRadio(nome) {
	el = document.getElementsByTagName("input");
	for(i=0;i<el.length;i++) {
		if( el[i].type == "radio" && el[i].name == nome && el[i].checked) {
			return el[i];
		}
	}

	return null;
}

function habilitaRadio(nome) {
	setDisabledRadio(nome,false);
}

function desabilitaRadio(nome) {
	setDisabledRadio(nome,true);
}


function contratoHabilitaFormaPagamento() {
	habilitaRadio("forma_pagamento");
	contratoAlteraFormaPagamento();
}

function contratoDesabilitaFormaPagamento() {
	desabilitaRadio("forma_pagamento");
	contratoAlteraFormaPagamento();
}

function contratoAlteraFormaPagamentoDA() {
	var frm=document.contratacao;

	var fp = getCheckedRadio("forma_pagamento");
	if( fp != null ) {
		valor = fp.value;
	} else {
		valor = null;
	}

	if( frm.agencia != undefined && frm.agencia != null && frm.conta != undefined && frm.conta != null ) {
		frm.agencia.disabled = true;
		frm.agencia.className="disabledFP";
		frm.conta.disabled = true;
		frm.conta.className="disabledFP";
	}
	if( fp != null && !fp.disabled ) {
		if(  valor == "DA" && frm.id_forma_pagamento_DA.value != "" ) {
			if( frm.agencia != undefined && frm.agencia != null && frm.conta != undefined && frm.conta != null ) {
				frm.agencia.disabled = false;
				frm.agencia.className="fieldWithoutFocusFP";
				frm.conta.disabled = false;
				frm.conta.className="fieldWithoutFocusFP";
			}
		}
	}
}


function contratoAlteraFormaPagamentoNA() {
	var frm=document.contratacao;

	var fp = getCheckedRadio("forma_pagamento");
	if( fp != null ) {
		valor = fp.value;
	} else {
		valor = null;
	}

	if( frm.agencia != undefined && frm.agencia != null && frm.conta != undefined && frm.conta != null ) {
		frm.agencia.disabled = true;
		frm.agencia.className="disabledFP";
		frm.conta.disabled = true;
		frm.conta.className="disabledFP";
	}
	if( fp != null && !fp.disabled ) {
		if(  valor == "NA" && frm.id_forma_pagamento_NA.value != "" ) {
			if( frm.agencia != undefined && frm.agencia != null && frm.conta != undefined && frm.conta != null ) {
				frm.agencia.disabled = false;
				frm.agencia.className="fieldWithoutFocusFP";
				frm.conta.disabled = false;
				frm.conta.className="fieldWithoutFocusFP";
			}
		}
	}
}


function contratoAlteraFormaPagamento() {
	var frm=document.contratacao;

	var fp = getCheckedRadio("forma_pagamento");
	if( fp != null ) {
		valor = fp.value;
	} else {
		valor = null;
	}

	if( frm.id_forma_pagamento_BL != undefined && frm.id_forma_pagamento_BL != null ) {
		frm.id_forma_pagamento_BL.disabled = true;
	}
	if( frm.id_forma_pagamento_DA != undefined && frm.id_forma_pagamento_DA != null ) {
		frm.id_forma_pagamento_DA.disabled = true;
	}
	if( frm.id_forma_pagamento_PC != undefined && frm.id_forma_pagamento_PC != null ) {
		frm.id_forma_pagamento_PC.disabled = true;
	}
	if( frm.id_forma_pagamento_MO != undefined && frm.id_forma_pagamento_MO != null ) {
		frm.id_forma_pagamento_MO.disabled = true;
	}
	if( frm.id_forma_pagamento_NA != undefined && frm.id_forma_pagamento_NA != null ) {
		frm.id_forma_pagamento_NA.disabled = true;
	}

	if( fp != null && !fp.disabled ) {
		if( frm.id_forma_pagamento_BL != undefined ) {
			if( valor == "BL" ) {
				frm.id_forma_pagamento_BL.disabled = false;
			}
		}

		if( frm.id_forma_pagamento_DA != undefined ) {
			if( valor == "DA" ) {
				frm.id_forma_pagamento_DA.disabled = false;
			}
		}

		if( frm.id_forma_pagamento_PC != undefined ) {
			if( valor == "PC" ) {
				frm.id_forma_pagamento_PC.disabled = false;
			}
		}

		if( frm.id_forma_pagamento_MO != undefined ) {
			if( valor == "MO" ) {
				frm.id_forma_pagamento_MO.disabled = false;
			}
		}

		if( frm.id_forma_pagamento_NA != undefined ) {
			if( valor == "NA" ) {
				frm.id_forma_pagamento_NA.disabled = false;
			}
		}
	}

	if( frm.id_forma_pagamento_DA != undefined ) {
		contratoAlteraFormaPagamentoDA();
	}

}

function contratoAlteraProduto() {
	var frm=document.contratacao;



	desabilita(frm.data_contratacao);
	desabilita(frm.vigencia);
	desabilita(frm.dia_vencimento);
	desabilita(frm.carencia);
	desabilita(frm.primeiro_vencimento_input);
	desabilita(frm.desconto_promo);
	desabilita(frm.periodo_desconto);
	desabilita(frm.tx_instalacao);
	desabilita(frm.parcelas_instalacao);
	desabilita(frm.comodato);
	desabilita(frm.pro_rata);
	desabilita(frm.valor_comodato);



	desabilita(frm.pagamento);
	contratoDesabilitaFormaPagamento();



	if( frm.id_cliente_produto.value == '' ) {
		desabilita(frm.username);
		contratoAlteraUsername();
		desabilita(frm.senha);
		desabilita(frm.confsenha);
	}




	//window.alert("CONTRATO: " + contrato);

	if( frm.id_produto.value == "" && frm.tipo_produto_original.value != '' ) {
		// window.alert("MIG: " + contrato.id_contrato);
		frm.id_produto.value = frm.id_produto_original.value;
	}




	if( frm.id_produto.value != "" ) {



		produto = contratoObtemPlano(frm.tipo.value,frm.id_produto.value);

		habilita(frm.data_contratacao);
		habilita(frm.vigencia);



		if( produto.valor > 0 ) {



			// Produto pago. Habilitar campos de valores
			habilita(frm.dia_vencimento);
			habilita(frm.carencia);
			//habilita(frm.primeiro_vencimento);
			habilita(frm.desconto_promo);
			habilita(frm.periodo_desconto);
			habilita(frm.tx_instalacao);
			habilita(frm.parcelas_instalacao);
			habilita(frm.comodato);
			habilita(frm.pro_rata);
			contratoAlteraComodato();

			habilita(frm.pagamento);
			contratoHabilitaFormaPagamento();

			if( produto.desconto_promo == null || produto.desconto_promo == undefined || produto.desconto_promo == "" || produto.periodo_desconto == null || produto.periodo_desconto == undefined || produto.periodo_desconto == "") {
				frm.desconto_promo.value = "";
				frm.periodo_desconto.value = "";
			} else {
				frm.desconto_promo.value = produto.desconto_promo;
				frm.periodo_desconto.value = produto.periodo_desconto;
			}

			if( produto.tx_instalacao == null || produto.tx_instalacao == undefined || produto.tx_instalacao == "" ) {
				frm.tx_instalacao.value = "";
			} else {
				frm.tx_instalacao.value = produto.tx_instalacao;
			}
		} else {
			cortesia = true;


		}



		if( frm.id_cliente_produto.value == '' ) {
			habilita(frm.username);
			contratoAlteraUsername();
			habilita(frm.senha);
			habilita(frm.confsenha);
		}



	}

}

function contratoAlteraComodato() {
	var frm = document.contratacao;
	if( frm.comodato.value == 't' ) {
		habilita(frm.valor_comodato);
	} else {
		desabilita(frm.valor_comodato);
	}
}

function contratoAlteraEndereco() {
	var frm = document.contratacao;

	if( frm.selecao_redeip.disabled || frm.selecao_redeip.value == "A" ) {
		desabilita(frm.endereco_redeip);
		frm.endereco_redeip.value = "";
	} else {
		habilita(frm.endereco_redeip);
	}
}


function formOnBlurSuf(obj,sufixo) {
	if( sufixo == null || sufixo == undefined ) {
		sufixo = "";
	}
	obj.className="fieldWithoutFocus"+sufixo;
}
function formOnFocusSuf(obj,sufixo) {
	if( sufixo == null || sufixo == undefined ) {
		sufixo = "";
	}
	obj.className="fieldWithFocus"+sufixo;
}

function checkStatusFields(tag) {

	 var id_condominio_cobranca = document.getElementById('id_condominio_cobranca');
	 var id_condominio_instalacao = document.getElementById('id_condominio_instalacao');

     if ( tag.name == "difEnderecoMail" ) {

       if ( tag.checked == false ) {
          desabilita(document.getElementById('endereco_cobranca'));
          desabilita(document.getElementById('bairro_cobranca'));
          desabilita(document.getElementById('complemento_cobranca'));
          desabilita(document.getElementById('id_cidade_cobranca'));
          desabilita(document.getElementById('cep_cobranca'));
          desabilita(document.getElementById('id_condominio_cobranca'));
          desabilita(document.getElementById('id_bloco_cobranca'));
          desabilita(document.getElementById('apto_cobranca'));

          if(id_condominio_cobranca) id_condominio_cobranca.value = "";

       }
       else {
          habilita(document.getElementById('endereco_cobranca'));
          habilita(document.getElementById('bairro_cobranca'));
          habilita(document.getElementById('complemento_cobranca'));
          habilita(document.getElementById('id_cidade_cobranca'));
          habilita(document.getElementById('cep_cobranca'));
          habilita(document.getElementById('id_condominio_cobranca'));

       }
    }
    else if ( tag.name == "difEnderecoSetup" ) {

       if ( tag.checked == false ) {
          desabilita(document.getElementById('endereco_instalacao'));
          desabilita(document.getElementById('bairro_instalacao'));
          desabilita(document.getElementById('complemento_instalacao'));
          desabilita(document.getElementById('id_cidade_instalacao'));
          desabilita(document.getElementById('cep_instalacao'));
          desabilita(document.getElementById('id_condominio_instalacao'));
          desabilita(document.getElementById('id_bloco_instalacao'));
          desabilita(document.getElementById('apto_instalacao'));

          if(id_condominio_instalacao) document.getElementById('id_condominio_instalacao').value="";
       }
       else {
          habilita(document.getElementById('endereco_instalacao'));
          habilita(document.getElementById('bairro_instalacao'));
          habilita(document.getElementById('complemento_instalacao'));
          habilita(document.getElementById('id_cidade_instalacao'));
          habilita(document.getElementById('cep_instalacao'));
          habilita(document.getElementById('id_condominio_instalacao'));

       }
    }
}

function calculaDiaProximaFatura() {

	// window.alert("CALCULA!!!");
   	var frm = document.contratacao;




	// year, mount, date
	var sD = frm.data_contratacao.value.split("/");

	// window.alert(frm.data_contratacao.value + "\n" + sD);



    var dia_ven = document.getElementById("dia_vencimento").value;
    // var data_base = new Date();
    // var data_base = new Date(sD[2],sD[1] - 1,sD[0]);
    var data_base = new Date(sD[2],sD[1] - 1,sD[0]);

    // window.alert("DATA BASE: " + data_base);


    dif =(parseInt(dia_ven)+30)-parseInt(data_base.getDate());



    //alert(dif);
    if ( dif >= LIMITE_PRORATA ) {
      data_base.setMonth(data_base.getMonth()+1);
    }
    else {
      data_base.setMonth(data_base.getMonth()+2);
    }

    mes = data_base.getMonth()+1;

    data_base.setDate(dia_ven);
    t_dia = data_base.getDate();


    for( t_dia = data_base.getDate(); t_dia != dia_ven; ) {
    	--dia_ven;
    	data_base.setDate(dia_ven);
    	data_base.setMonth(mes - 1);
    	t_dia = data_base.getDate();
		if(confirm(tdia + " <---> " + dia_ven))return;
    	if( t_dia == 0 || dia_ven == 0 || !t_dia || !dia_ven ) {
    		break;
    	}

    }


    if ( mes < 10 )
       mes = "0"+mes;

    if ( dia_ven < 10 )
       dia_ven = "0"+dia_ven;




    frm.primeiro_vencimento_input.value = dia_ven+"/"+mes+"/"+data_base.getYear();
    frm.primeiro_vencimento.value = dia_ven+"/"+mes+"/"+data_base.getYear();
}

function replaceField(field) {

  if ( document.getElementById("difEnderecoSetup").checked == false ) {

    if ( field != "id_cidade" ) {

      document.getElementById(field+"_instalacao").value = document.getElementById(field+"_cobranca").value;

    }
    else {

      var selC = document.getElementById(field+"_cobranca");
      var selI = document.getElementById(field+"_instalacao");

      for ( i=0; i<selI.options.length; i++ ) {

        if ( selI.options[i].value == selC.options[ selC.selectedIndex ].value ) {

          selI.selectedIndex = i;
          break;
        }
      }
    }
  }

}


returnStatus = false;
function checkEnderecoDisponivel(id_nas, endereco){
	var url = "admin-ajax.php";
	var pars = "op=contas&output=JSON&query=enderecoDisponivel&id_nas="+id_nas+"&endereco="+endereco;

	var myAjax = new Ajax.Request(
		url,
		{
			method: 'get',
			parameters: pars,
			onComplete: showResponse,
			asynchronous: false
		});

	return returnStatus;
}

function showResponse(originalRequest) {
	var r = originalRequest.responseText.evalJSON();
	if(r.codigo > 0){
		alert(r.mensagem)
		returnStatus = false;
		return false;
	}

	returnStatus = true;
	document.getElementById('endereco_redeip').value = r.endereco;
}


function validacao(frm ) {
	var migracao = false;

	if( frm.id_cliente_produto.value != null && frm.id_cliente_produto.value != '' ) {
	   migracao = true;
	}

	// window.alert("migracao: " + migracao);

	// if( frm.id_cliente_produt

	// window.alert("validacao");
	// window.alert(frm.id_cliente_produto.value);

	if( !document.getElementById('tipo').value ) {
		window.alert("É necessário escolher o tipo de contrato.");
		return false;
	}

	if( document.getElementById('tipo').value != '' && document.getElementById('id_produto_original').value != '') {
		migracao = true;
		if( document.getElementById('id_produto_original').value == document.getElementById('id_produto').value ) {
			// window.alert("Você deve escolher outro plano para migrar o contrato.");

			if( !window.confirm("Você está tentando migrar para o mesmo plano. Esta opção é útil para alteração de vencimento e alteração de plano.\n\nSe está certo da operação clique em 'OK', caso contrário clique em 'Cancelar'") ) {
				return false;
			}
		}
	}

	if( !migracao ) {
		// window.alert("NOT MIGRACAO");

			username = frm.username.value;
			criar_email = document.getElementById('criar_email').value;
			id_produto = document.getElementById('id_produto').value;

			if(!id_produto) {
				alert("É necessário escolher um produto para efetuar a contratação.");
				return false;
			}

			if( username == "" ) {
				alert("É necessário selecinar um username");
				return false;
			}

			tipo = document.getElementById('tipo').value;

			// window.alert("USER: [" + username + "]");

			if(tipo == "BL") {

				// window.alert('BL!!!!');

				if(!checkDadosConexao()){
					// window.alert("!CDC!!!");
					return false;
				}
			}

			// if(username != ""){

				if(!validaUsernameString(username)) {
					alert("Não é permitido a inserção de espaços e caracteres maúsculos e caracteres especiais diferentes de \".\" e \"_\" no username.");
					return false;
				}

				if(!validaUsername()){
					window.alert("O username escolhido já está sendo utilizado no sistema.");
					return false;
				}
			// }

			if(criar_email.checked){
				if(!validaEmail()){
					return false;
				}
			}
	} else {
		dia_vencimento = document.getElementById('dia_vencimento');
		carencia = document.getElementById('carencia');

		if( 1 > dia_vencimento.value){
			alert("Informe o dia de vencimento!");
			if( dia_vencimento.enabled ) {
				dia_vencimento.focus();
			}
			return false;
		}

		if( 1 > carencia.value){
			alert("Informe a carencia!");
			if( carencia.enabled ) {
				carencia.focus();
			}
			return false;
		}
	}


	if ( !cortesia && ( frm.endereco_cobranca.value == '' || frm.bairro_cobranca.value == '' || frm.cep_cobranca.value == '') ) {
		alert('Preencha o endereco de cobranca!');
		frm.difEnderecoMail.checked = true;
		checkStatusFields(frm.difEnderecoMail);
		return false;
	} else {
		if( !migracao ) {
			if ( (frm.endereco_instalacao.value == '' || frm.bairro_instalacao.value == '' || frm.cep_instalacao.value == '') && (frm.tipo != "H") ) {
				alert('Preencha o endereco de instalacao!');
				frm.difEnderecoSetup.checked = true;
				checkStatusFields(frm.difEnderecoSetup);
				return false;
			}
		}
	}

	if( !migracao ) {
		if ( frm.senha.value != frm.confsenha.value ) {
			alert('Verifique a senha!');
			if( frm.senha.enabled ) {
				frm.senha.focus();
			}
			return false;
		}

		if ( frm.senha.value || frm.confsenha.value ) {
			username = document.getElementById('username').value;
			if(estaVazio(username)) {
				alert("Foi informada uma senha e não informado um username. Deixe todos os campos em branco referentes a username e senha ou preencha todos os campos campos.");
				document.getElementById('username').value = "";
				frm.senha.value = "";
				frm.confsenha.value = "";
				document.getElementById('username').focus();
				return false;
			}
		}
	}

	if( document.getElementById('tipo') == 'BL' ) {
		var mac = document.getElementById('mac');
		var selecao_redeip = document.getElementById('selecao_redeip');
		var endereco_redeip = document.getElementById('endereco_redeip');
		var nas = document.getElementById('id_nas');
		var pop = document.getElementById('id_pop');

		if("" == nas.value){
			alert("Selecione um nas!");
			if( nas.enabled ) {
			   nas.focus();
			}
			return false;
		}

		if("" == pop.value){
			alert("Selecione um pop!");
			if( pop.enabled ) {
				pop.focus();
			}
			return false;
		}

		if("M" == selecao_redeip.value) {
			if("" != endereco_redeip.value){
				if( !checkEnderecoDisponivel(nas.value,endereco_redeip.value) ){
					return false;
				}
			} else {
				alert("Preencher o campo de endereço IP!");
				if( endereco_redeip.enabled ) {
					endereco_redeip.focus();
				}
				return false;
			}
		}

		var nas_text = nas.options[nas.options.selectedIndex].text
		var nas_type=nas_text.split(":");
		if( ("IP" == nas_type[0]) && ("" == mac.value) ){
			if(!confirm("O Não preenchimento do MAC pode facilitar o acesso de usuários não autorizados no sistema. Deseja proceguir mesmo SEM o mac?")){
				return false;
			}
		}

	}

	return true;
}

function checkDadosConexao(){

	var frm = document.contratacao;

	var nas = frm.id_nas;
	var pop = frm.id_pop;
	var mac = frm.mac;
	var id_cliente_produto = frm.id_cliente_produto;
	var migracao = false;
	if( id_cliente_produto.value != '' ) {
		migracao = true;
	}
	var altera_rede = frm.altera_rede;
	var selecao_redeip = frm.selecao_redeip;
	var endereco_redeip = frm.endereco_redeip;

	if( !nas.value ) {
		// window.alert('NOT NAS');
		window.alert("É necessário escolher um NAS.");
		return false;
	}

	if( !pop.value ) {
		window.alert("É necessário escolher um POP.");
		return false;
	}

	var nas_text = nas.options[nas.options.selectedIndex].text;
	var nas_type=nas_text.split(":");
	if( ("IP" == nas_type[0]) && ("" == mac.value) ){
		if(!confirm("O Não preenchimento do MAC pode facilitar o acesso de usuários não autorizados no sistema. Deseja proceguir mesmo SEM o mac?")){

			return false;
		}
	}

	// window.alert("CKPoint 2: " + selecao_redeip.value + "/" + endereco_redeip.value );


	if("M" == selecao_redeip.value) {
		if("" != endereco_redeip.value){
			if( !checkEnderecoDisponivel(nas.value,endereco_redeip.value) ){
				return false;
			}
		} else {
			alert("Preencher o campo de endereço IP!");
			if( endereco_redeip.enabled ) {
				endereco_redeip.focus();
			}
			return false;
		}
	}

	return true;
}


function antiRepost() {
	var frm=document.contratacao;

	if( enviando ) {
		return(false);
	}
	frm.submit.disabled = true;
	enviando = true;

}

function checkForm(tag) {

	if( enviando ) {
		return(false);
	}

	calculaDiaProximaFatura();

  var frm=document.contratacao;



  var fp = getCheckedRadio("forma_pagamento");
  if( fp != null ) {
  	valor = fp.value;
  } else {
  	valor = null;
  }



  if( valor == '' || valor == null ) {
	var produto = contratoObtemPlano(frm.tipo.value,frm.id_produto.value);

	if( produto.valor > 0 ) {
		window.alert("Você deve escolher a forma de pagamento.");
		return false;
	}

  }



	if( !validacao(tag) ) {
		return(false);
	}

	tag.submit.disabled = true;
	enviando = true;



  return(true);


  // return validacao(tag);


}


function validarData(campo){

  var expReg = /^(([0-2]\d|[3][0-1])\/([0]\d|[1][0-2])\/[1-2][0-9]\d{2})$/;
  var msgErro = 'Formato inválido de data. Use: mm/dd/aaaa';
  if ((campo.value.match(expReg)) && (campo.value!='')){
    var dia = campo.value.substring(0,2);
    var mes = campo.value.substring(3,5);
    var ano = campo.value.substring(6,10);

    //alert(dia);    alert(mes);    alert(ano);

    if( (mes==4 || mes==6 || mes==9 || mes==11) && dia > 30){
      alert("Dia incorreto !!! O mês especificado contém no máximo 30 dias.");
      campo.focus();
      return false;
    }
    else{
      if(ano%4!=0 && mes==2 && dia>28){
        alert("Data incorreta!! O mês especificado contém no máximo 28 dias.");
        campo.focus();
        return false;
      }
      else{

        if(ano%4==0 && mes==2 && dia>29){
          alert("Data incorreta!! O mês especificado contém no máximo 29 dias.");
          campo.focus();
          return false;
        }
        else{
          //alert ("Data correta!");
          return true;
        }

      }
    }
  }
  else {
    alert(msgErro);
    campo.focus();
    return false;
  }
}

{/literal}
</script>
<style>
{literal}
.divBoxContratacao {
	visibility: visible;

	margin-bottom: 0px;
	padding-bottom: 0px;
}

.boxContratacao {
	margin-top: 2px;
	border: solid 1px #000000;
	margin-bottom: 0px;
	padding-bottom: 0px;
}

.boxContratacao TD {

}

.boxContratacao TH {
	background: #aaccaa;
}

.fieldWithFocusFP {
	border: solid 1px #004400;
	margin-right: 2px;
 	background-color: #F3F9F3;
 	font-family: verdana;
 	color: #005500;
 	font-size: 8px;
}

.fieldWithoutFocusFP {
	border: solid 1px #000000;
	margin-right: 2px;
	background-color: #FFFFFF;
 	color: #000000;
 	font-family: verdana;
 	font-size: 8px;
}

.disabledFP {
	border: solid 1px #DADADA;
	margin-right: 2px;
	background-color: #FFFFFF;
 	color: #000000;
 	font-family: verdana;
 	font-size: 8px;
}

{/literal}
</style>
<br>
<form style="margin-top: 0; padding-top: 0" name="contratacao" id="contratacao" action="admin-clientes.php" method="post" {if $acao == ""}onSubmit="return checkForm(this);"{else}onSubmit="return antiRepost();"{/if} >
<input type="hidden" name="op" id="op" value="{$op}">
<input type="hidden" name="tela" id="tela" value="{$tela}">
<input type="hidden" name="id_cliente" id="id_cliente" value="{$id_cliente}">
<input type="hidden" name="id_cliente_produto" id="id_cliente_produto" value="{$id_cliente_produto}">
<input type="hidden" name="tipo_produto_original" id="tipo_produto_original" value="{$contrato.tipo_produto}">
<input type="hidden" name="id_produto_original" id="id_produto_original" value="{$contrato.id_produto}">
<input type="hidden" name="id_forma_pagamento" id="id_forma_pagamento" value="{$contrato.id_forma_pagamento}">
{if $acao == ""}
	<input type="hidden" name="acao" id="acao" value="novo_contrato">

  <table class="lista" border=0 cellspacing=0 cellpadding=0 align="center">
	<tr>
		<th colspan=8 width=760 >Contratante </th>
	</tr>
	<tr>
		<td align="right"><strong>Nome:</strong></td>
		<td align="left"><strong>{$nome_razao}</strong></td>
		<td align="center" colspan=4><input type="checkbox" name="difEnderecoMail" id="difEnderecoMail" OnClick="checkStatusFields(this);" ><label>Especificar outro endere&ccedil;o pra cobran&ccedil;a</label></td>
    </tr>

	{if $condominios != "[]"}
  	<tr>
			<td align="right"><strong>Condomínio:</strong></td>
			<td align="left">
				<select name="id_condominio_cobranca" id="id_condominio_cobranca"  class="disabled" onchange="javascript:AjustarCamposFormularioContratoCobranca('contratacao', this.selectedIndex -1 , condominios);" DISABLED/>
					<option value="">-- SELECIONE --</option>
				</select>
			</td>
      		<td align="right" ><strong>Bloco:</strong></td>
			<td align="left" >
				<select name="id_bloco_cobranca" id="id_bloco_cobranca" class="disabled" DISABLED/>
					<option value="">-- SELECIONE --</option>
				</select>
			</td>
	</tr>

	<tr>
			<td align="right">&nbsp;</td>
			<td align="left">&nbsp;</td>
      		<td align="right" ><strong>Apto:</strong></td>
			<td align="left" >
				<input type="text" value="{$apto}" name="apto_cobranca" id="apto_cobranca" class="disabled" DISABLED/>
			</td>
    </tr>
	{/if}

  	<tr>
			<td align="right"><strong>Endereço:</strong></td>
			<td align="left"><input type="text" size="50" maxlength="50" disabled name="endereco_cobranca" id="endereco_cobranca" value="{$endereco}"  class="disabled" onFocus="javascript:formOnFocus(this)" onBlur="formOnBlur(this); replaceField('endereco');"></td>
      <td align="right" ><strong>Complemento:</strong></td>
			<td align="left" ><input type="text" size="30" maxlength="40" disabled name="complemento_cobranca" id="complemento_cobranca" value="{$complemento}"  class="disabled" onFocus="javascript:formOnFocus(this)" onBlur="formOnBlur(this); replaceField('complemento');"></td>
    </tr>
    <tr>
      <td align="right"><strong>Bairro:</strong></td>
			<td align="left"><input type="text" size="25" maxlength="40" disabled name="bairro_cobranca" id="bairro_cobranca" value="{$bairro}" class="disabled" onFocus="javascript:formOnFocus(this)" onBlur="formOnBlur(this); replaceField('bairro');">
      &nbsp;&nbsp;<strong>CEP:</strong>&nbsp;<input type="text" size="13" disabled maxlength="15" name="cep_cobranca" id="cep_cobranca" value="{$cep}" class="disabled" onFocus="javascript:formOnFocus(this)" onBlur="formOnBlur(this); replaceField('cep');">
      </td>
  		<td align="right"><strong>Cidade:</strong></td>
			<td align="left">
        <input type="hidden" name="id_cidade_cobranca" id="id_cidade_cobranca" value="{$id_cidade}" />
        <select class="disabled" style="width:210px" disabled name="id_cidade_cobranca_combo" id="id_cidade_cobranca_combo" tabindex="10" onBlur="formOnBlur(this);" onFocus="javascript:formOnFocus(this)" onChange="replaceField('id_cidade'); document.getElementById('id_cidade_cobranca').value = this.value;" >
  				{foreach item=a from=$cidades_disponiveis}
  						<option value='{$a.id_cidade}' {if $a.id_cidade == $id_cidade}selected{/if}>{$a.cidade}
								- {$a.uf}</option>
					{/foreach}
      </td>
	</tr>
  </table>


  <table border=0 align="center" cellspacing=0>
		<tr>
{if $tela == "migrar"}
			<td valign="top">
				<table width="380" cellspacing=0 cellpadding=0 class="boxContratacao">
					<tr>
						<th colspan=4 align="left">&nbsp; &nbsp;<label>MIGRAÇÃO DE CONTRATO:</label></th>
					</tr>
					<tr>
						<td style="padding: 5px 5px 5px 5px;">
							<p align="justify"><span style="font-family: verdana; color: #0000FF; font-size: 12px;">
								&nbsp; &nbsp;Você está iniciando a operação de migração de contrato.
								Nesta operação, todas as faturas a vencer, assim como as contas deste contrato serão migradas para um novo contrato.
							</span></p>
						</td>
					</tr>
				</table>

				<table width="380" cellspacing=0 cellpadding=0 class="boxContratacao">
					<tr>
						<th colspan=4 align="left">&nbsp; &nbsp;<label>Contas que serão migradas:</label></th>
					</tr>

					{foreach name=registros item=c from=$listaContas}
					<tr>
						<td><label>&nbsp; {$c.username}{if $c.tipo_conta == "E"}@{$c.dominio}{/if}</label></td>
						<td><label>{if $c.tipo_conta == 'BL'}Banda Larga{elseif $c.tipo_conta == 'E'}Email{elseif $c.tipo_conta=='H'}Hospedagem{elseif $tipo_conta == 'D'}Discado{/if}</label></td>
						<td><label>{if $c.status == "A"}Ativa{elseif $c.status == "B"}Bloqueado{elseif $c.status == "S"}Suspenso{elseif $c.status == "C"}Cancelado{/if}</label></td>
					</tr>

					{/foreach}

				</table>
			</td>
{/if}

			<td valign="top">
				<table width="380" cellspacing=0 cellpadding=0 class="lista">
					<tr>
						<th align="right"><label>Contrato: {$contrato.tipo_produto}</label></th>
						<th colspan=3 align="left">
							<select name="tipo" id="tipo" onChange="contratoAlteraTipo()" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
								{if $tela == "novo_contrato"}
								<option value="">-- SELECIONE --</option>
								{/if}
								{if $tela == "novo_contrato" || $contrato.tipo_produto == "BL"}
								<option value="BL" {if $tela == "migrar"}SELECTED{/if}>Banda Larga</option>
								{/if}
								{if $tela == "novo_contrato" || $contrato.tipo_produto == "D "}
								<option value="D" {if $tela == "migrar"}SELECTED{/if}>Discado</option>
								{/if}
								{if $tela == "novo_contrato" || $contrato.tipo_produto == "H "}
								<option value="H" {if $tela == "migrar"}SELECTED{/if}>Hospedagem</option>
								{/if}
							</select>
						</th>
					</tr>
					<tr>
						<td align="right"><label>Produto:</label></td>
						<td colspan="3"><select style="width: 250px;" name="id_produto" id="id_produto" onChange="javascript: contratoAlteraProduto()" class="fieldWithoutFocus" onFocus="formOnFocus(this);" onBlur="formOnBlur(this); calculaDiaProximaFatura();"></select></td>
					</tr>
					<tr>
						<td align="right" width="120"><label>Dt. Contrato:</label></td>
						<td><input type="text" size="12" maxlength="10" name="data_contratacao" id="data_contratacao" value="{$data_contratacao}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="formOnBlur(this); validarData(this);"></td>
						<td align="right" width="120"><label>Vigência:</label></td>
						<td><input type="text" size="4" maxlength="2" name="vigencia" id="vigencia" value="{$vigencia}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><label>meses</label></td>
					</tr>
					<tr>
						<td align="right"><label>Dia Venc.:</label></td>
						<td><input type="text" size="4" maxlength="2" name="dia_vencimento" id="dia_vencimento" value="{$dia_vencimento}" class="fieldWithoutFocus" onFocus="formOnFocus(this);calculaDiaProximaFatura();" onBlur="formOnBlur(this); calculaDiaProximaFatura();"></td>
						<td align="right"><label>Carência:</label></td>
						<td><input type="text" size="4" maxlength="2" name="carencia" id="carencia" value="{$carencia}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><label>dias</label></td>
					</tr>
					<tr>
						<td align="right"><label>Pr&oacute;x. Fatura:</label></td>
						<td align="left" ><input type="text" size="12" maxlength="10" name="primeiro_vencimento_input" id="primeiro_vencimento_input" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"></td>
						<input type="hidden" name="primeiro_vencimento" id="primeiro_vencimento" value="" >
						<td align="right" ><label>Pro Rata:</label></td>
						<td align="left" ><select name="pro_rata" id="pro_rata" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
                				{foreach item=d from=$lista_boolean}
								<option value='{$d.id}' {if $d.id == $pro_rata}SELECTED{/if}>{$d.nome}</option>
								{/foreach}
							</select>
							</td>
							<input type="hidden" name="limite_prorata" id="limite_prorata" value="{$limite_prorata}" >
     				</tr>
					<tr>
						<td align="right"><label>Desconto:</label></td>
						<td><input type="text" size="6" maxlength="6" name="desconto_promo" id="desconto_promo" value="{$desconto_promo}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><label>reais</label></td>
						<td align="right"><label>Período:</label></td>
						<td><input type="text" size="4" maxlength="2" name="periodo_desconto" id="periodo_desconto" value="{$periodo_desconto}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><label>meses</label></td>
					</tr>
					<tr>
						<td align="right" width="105"><label>Tx Instalação:</label></td>
						<td align="left" ><input type="text" size="6" maxlength="6" name="tx_instalacao" id="tx_instalacao" value="{$tx_instalacao}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><label>reais</label></td>
						<td align="right" width="105"><label>Parcelas:</label></td>
						<td align="left" ><input type="text" size="6" maxlength="6" name="parcelas_instalacao" id="parcelas_instalacao" value="{$parcelas_instalacao}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><label></label></td>
					</tr>
					<tr>
						<td align="right"><label>Comodato:</label></td>
						<td>
							<select name="comodato" id="comodato" onChange="javascript:contratoAlteraComodato()" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
								{foreach item=d from=$lista_boolean}
								<option value='{$d.id}' {if $d.id == $comodato}SELECTED{/if}>{$d.nome}</option>
								{/foreach}
							</select>
						</td>
						<td align="right"><label>v.comodato:</label></td>
						<td><input type="text" size="8" maxlength="6" name="valor_comodato" id="valor_comodato" value="{$valor_comodato}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><label>reais</label></td>
					</tr>
				</table>
				<table width="380" cellspacing=0 cellpadding=0 class="lista">
					<tr>
						<th align="right" width="120"><label>Cobrança:</label></th>
						<th align="right" colspan=3>&nbsp;</th>
					</tr>
					<tr>
						<td align="right" width="120"><label>Pagamento:</label></td>
						<td colspan="3">
							<select name="pagamento" id="pagamento" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
							{foreach key=k item=v from=$tiposPagamento}
								<option value="{$k}" {if $k==$pagamento}SELECTED{/if}>{$v}</option>
							{/foreach}
							</select>
						</td>
					</tr>
					<tr>
						<td align="right"><label>Forma Pgto:</label></td>
						<!--td colspan="4">&nbsp;
							<select name="forma_pagamento" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
							{foreach item=v from=$formasPagamento}
								<option id="{$v.id_forma_pagamento}">{$tiposFormaPgto[$v.tipo_cobranca]}{if $v.tipo_cobranca == "DA" || $v.tipo_cobranca == "BL"}: {$bancos[$v.codigo_banco]} - convênio {$v.convenio}{/if}</option>
							{/foreach}
							</select>
						</td-->
						<td colspan=2>
							<table border=0 class="lista" width="100%" cellspacing=0 cellpadding=0>
							{assign var=estilo value='impar'}
							{foreach name=registros key=tipo item=v from=$formasPagamento}
								{if count($v) }
									{if $estilo=='impar'}{assign var=estilo value='par'}{else}{assign var=estilo value='impar'}{/if}
									<tr>
										<td width="10" class='{$estilo}'><label><input type="radio" name="forma_pagamento" id="forma_pagamento" value="{$tipo}" onClick="javascript:contratoAlteraFormaPagamento()" {if $tipo == $forma_pagamento_original}CHECKED{/if}></td>
										<td class='{$estilo}'>
											<b>{$tiposFormaPgto[$tipo]}</b><br><span style="font-family: arial; font-size: 8px;">

												<table border=0 cellpadding=0 cellspacing=0>
													<tr>
														<td>
															<select name="id_forma_pagamento_{$tipo}" id="id_forma_pagamento_{$tipo}" class="fieldWithoutFocusFP" onFocus="javascript:formOnFocusSuf(this,'FP')" onBlur="javascript:formOnBlurSuf(this,'FP')" {if $tipo == "DA"} onChange="javascript:contratoAlteraFormaPagamentoDA()"{/if}>
																<option value="">-- SELECIONE --</option>
																{foreach item=f from=$v}


																	{if $tipo == "DA" || $tipo == "BL" && $f.carne == 't'}
																		<option value="{$f.id_forma_pagamento}" {if $f.id_forma_pagamento == $contrato.id_forma_pagamento}SELECTED{/if}>
																			{$bancos[$f.codigo_banco]} - convênio {$f.convenio}
																		</option>
																	{elseif $tipo == "MO"}
																		<option value="{$f.id_forma_pagamento}" {if $f.id_forma_pagamento == $contrato.id_forma_pagamento}SELECTED{/if}>
																			{$f.id_forma_pagamento}
																		</option>
																	{elseif $tipo == "PC"}
																		<option value="{$f.id_forma_pagamento}" {if $f.id_forma_pagamento == $contrato.id_forma_pagamento}SELECTED{/if}>
																			{$bancos[$f.codigo_banco]} - convênio {$f.convenio}
																		</option>
																	{/if}


																{/foreach}
															</select>
														</td>
													</tr>
													{if $tipo == "DA"}
													<tr>
														<td width="100%">
															<table border=0 cellspacing=0 cellpadding=0 width="100">
																<tr>
																	<td align="right"><label style="font-size: 8px">ag:</label>
																	<td><input type="text" size="8" maxlength="4" name="agencia" id="agencia" value="{if $contrato.da_agencia}{$contrato.da_agencia}{/if}" class="fieldWithoutFocusFP" onFocus="javascript:formOnFocusSuf(this,'FP')" onBlur="javascript:formOnBlurSuf(this,'FP' )"></td>
																	<td aling="right"><label style="font-size: 8px">cc:</label>
																	<td><input type="text" size="8" maxlength="10" name="conta" id="conta" value="{if $contrato.da_num_conta}{$contrato.da_num_conta}{/if}" class="fieldWithoutFocusFP" onFocus="javascript:formOnFocusSuf(this,'FP')" onBlur="javascript:formOnBlurSuf(this,'FP')"></td>
																</tr>
															</table>
														</td>
													</tr>
													{/if}
												</table>

											</span>
											</label>
										</td>
									</tr>
									<tr>
								{/if}
							{/foreach}

							<tr> {if $estilo=='impar'}{assign var=estilo value='par'}{else}{assign var=estilo value='impar'}{/if}
								<td class='{$estilo}'><input type="radio" name="forma_pagamento" id="forma_pagamento" value="NA" onClick="javascript:contratoAlteraFormaPagamento()"/></td>
								<td class='{$estilo}'>
									<b>Não atrelar</b>
								</td>
							</tr>
							</table>

						</td>
					</tr>
				</table>
			</td>
{if $tela != "migrar"}
			<td valign="top">
				<table width="380" cellspacing=0 cellpadding=0 class="lista">
					<tr>
						<th colspan=4 align="left">&nbsp; &nbsp;<label>Dados do Usuário:</label></th>
					</tr>
					<tr>
						<td align="right" width="120"><label>Username:</label></td>
						<td colspan=3><input type="text" size="30" maxlength="20" name="username" id="username" value="{$username}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this);contratoAlteraUsername();"></td>
					</tr>
					<tr>
						<td align="right" width="120"><label>Senha:</label></td>
						<td colspan=3>
							<label>
								<input type="password" size="20" maxlength="20" name="senha" id="senha" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><br>
								<input type="password" size="20" maxlength="20" name="confsenha" id="confsenha" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"> (confirme)
							</label>
						</td>
					</tr>
					<tr>
						<td align="right"><input type="checkbox" name="criar_email" id="criar_email" value="t"></td>
						<td><label>criar email @{$preferenciasGerais.dominio_padrao} com usuário e senha acimas.</label></td>
					</tr>
				</table>
				<!-- BANDA LARGA-->
				<div id="boxTarget" style="position:relative"></div>
				<div id="boxTemporaria"  style="position:relative"></div>
				<div id="boxBL" class="divBoxContratacao">
					<table width="380" cellspacing=0 cellpadding=0 class="lista">
						<tr>
							<th colspan=4 align="left">&nbsp; &nbsp;<label>Dados da Conexão:</label></th>
						</tr>
						<tr>
							<td align="right" width="120"><label>NAS:</label></td>
							<td colspan=3>
								<select onchange="javascript:alteraNas();" id="id_nas" name="id_nas" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
									<option value="">-- SELECIONE --</option>
								{foreach item=v from=$listaNAS}
									{if ($v.tipo_nas == "I") || ($v.tipo_nas == "P")}<option value="{$v.id_nas}">{$tiposNAS[$v.tipo_nas]}:{$v.nome}</option>{/if}
								{/foreach}
								</select>
								<input type="hidden" name="nas_orig" id="nas_orig" value="" />
							</td>
						</tr>
						<tr>
							<td align="right" width="120"><label>POP:</label></td>
							<td colspan=3>
								<select name="id_pop" id="id_pop" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
									<option value="">-- SELECIONE --</option>
								{foreach item=v from=$listaPOP}
									<option value="{$v.id_pop}">{$v.nome}</option>
								{/foreach}
								</select>
							</td>
						</tr>
						<tr>
							<td align="right" width="120"><label>Rede/IP:</label></td>
							<td colspan=3>
								<select name="selecao_redeip" id="selecao_redeip" onChange="contratoAlteraEndereco()" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
									<option value="A">Automática</option>
									<option value="M">Manual</option>
								</select>
								<input type="text" name="endereco_redeip" id="endereco_redeip" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
							</td>
						</tr>
						<tr>
							<td align="right" width="120"><label>MAC:</label></td>
							<td colspan=3>
								<input type="text" name="mac" id="mac" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
							</td>
					</table>
				</div>
				<!-- DISCADO -->
				<div id="boxD" class="divBoxContratacao">
					<table width="380" cellspacing=0 cellpadding=0 class="lista">
						<tr>
							<th colspan=4 align="left">&nbsp; &nbsp;<label>Dados do Acesso:</label></th>
						</tr>
						<tr>
							<td align="right" width="120"><label>Fone:</label></td>
							<td colspan=3><input type="text" size="30" maxlength="20" name="foneinfo" id="foneinfo" value="{$foneinfo}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"></td>
						</tr>
					</table>
				</div>
				<!-- ENDERECO INSTALACAO -->
				<div id="boxEI" class="divBoxContratacao">
					<table width="380" cellspacing=0 cellpadding=0 class="lista">


						<tr>
							<th colspan=4 align="left">&nbsp; &nbsp;<label>Endere&ccedil;o de Instala&ccedil;&atilde;o:</label></td>
						</tr>
						<tr>
						<td colspan=4 >
							<input type="checkbox" name="difEnderecoSetup" id="difEnderecoSetup" OnClick="checkStatusFields(this);" ><label>Especificar outro endere&ccedil;o  pra instala&ccedil;&atilde;o:</label>
						</td>
						</tr>

						{if $condominios != "[]"}
						<tr>
							<td align="right" width="120"><label>Condominio:</label></td>
							<td colspan=3>
								<select name="id_condominio_instalacao" class="fieldWithoutFocus" id="id_condominio_instalacao" onchange="javascript:AjustarCamposFormularioContratoInstalacao('contratacao', this.selectedIndex -1 , condominios_instalacao);" DISABLED>
									<option value="">-- SELECIONE --</option>
								</select>
							</td>
						</tr>

						<tr>
							<td align="right" width="120"><label>Bloco:</label></td>
							<td colspan=3>
								<select name="id_bloco_instalacao" id="id_bloco_instalacao" class="fieldWithoutFocus" DISABLED>
									<option value="">-- SELECIONE --</option>
								</select>
							</td>
						</tr>

						<tr>
							<td align="right" width="120"><label>Apto:</label></td>
							<td colspan=3>
								<input type="text" value="{$apto}" name="apto_instalacao" id="apto_instalacao" class="disabled" DISABLED>
							</td>
						</tr>
						{/if}

						<tr>
							<td align="right" width="120"><label>Endere&ccedil;o:</label></td>
							<td colspan=3><input type="text" size="46" maxlength="50" disabled name="endereco_instalacao" id="endereco_instalacao" value="{$endereco}" class="disabled" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"></td>
						</tr>
						<tr>
							<td align="right" width="120" ><label>Complemento:</label></td>
							<td align="left" ><input type="text" size="16" maxlength="30" disabled name="complemento_instalacao" id="complemento_instalacao" value="{$complemento}" class="disabled" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"></td>
							<td align="right" ><label>Bairro:</label></td>
							<td align="left" ><input type="text" size="16" maxlength="30" disabled name="bairro_instalacao" id="bairro_instalacao" value="{$bairro}" class="disabled" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"></td>
						</tr>
						<tr>
							<td align="right" width="120"><label>CEP:</label>
							<td align="left" colspan=3><input type="text" size="16" disabled maxlength="30" name="cep_instalacao" id="cep_instalacao" value="{$cep}" class="disabled" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"></td>
						</tr>
						<tr>
							<td align="right" ><label>Cidade:</label></td>
							<td align="left" colspan=4 >
								<input type="hidden" name="id_cidade_instalacao" id="id_cidade_instalacao" value="{$id_cidade}" />
								<select  class="disabled" style="width:210px" disabled name="id_cidade_instalacao_combo" id="id_cidade_instalacao_combo" tabindex="10" class="disabled" onchange="javascript:AjustarCamposFormularioContratoInstalacao('contratacao', this.selectedIndex -1 , condominios);" onBlur="javascript:formOnBlur(this)" onFocus="javascript:formOnFocus(this)">
								{foreach item=a from=$cidades_disponiveis}

								<option value='{$a.id_cidade}' {if $a.id_cidade == $id_cidade}selected{/if}>{$a.cidade}
								- {$a.uf}</option>
								{/foreach}
							</td>
						</tr>
					</table>
				</div>
				<!-- HOSPEDAGEM -->
				<div id="boxH" class="divBoxContratacao">
					<table width="380" cellspacing=0 cellpadding=0 class="lista">
						<tr>
							<th colspan=4 align="left">&nbsp; &nbsp;<label>Dados da Hospedagem:</label></th>
						</tr>
						<tr>
							<td align="right" width="120"><label>Tipo:</label></td>
							<td colspan=3>
								<select name="tipo_hospedagem" id="tipo_hospedagem" onChange="javascript:contratoAlteraTipoHospedagem()" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)">
									<option value="D">Domínio do Usuário</option>
									<option value="U">www.{$preferenciasGerais.dominio_padrao}/usuario/username</option>
								</select>
							</td>
						<tr>
							<td align="right" width="120"><label>Criar:</label></td>
							<td colspan=3><label style="margin-right: 0px">www.</label><input type="text" size="30" maxlength="20" name="dominio_hospedagem" id="dominio_hospedagem" value="{$dominio_hospedagem}" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"></td>
						</tr>
					</table>
				</div>
			</td>
{/if}
		</tr>
	</table>
	<table border=0 width=720 align="center">
		<tr valign="top">
			<td style="border-top: dotted 1px #000000" colspan=2 align="center">
				<input type="button" name="prosseguir" id="prosseguir" value="Cancelar" class="botao" onClick="return Cancelar()"> <input type="submit" name="submit" id="submit" value="Prosseguir" class="botao">
			</td>
		</tr>
	</table>


</form>

<script>
/**
 * Inicializações
 */
contratoAlteraTipo();
contratoAlteraFormaPagamentoDA();

</script>


{/if}

{if $acao == "gravar_novo_contrato"}


<table border=0 cellspacing=0 cellpadding=0 width="650" align="center">
		<tr>
			<td align="center">Produto Cadastrado com Sucesso</td>
		</tr>
		<tr>
				<td align="center"><a href="" class="lista">Impressão do Contrato</a></td>
		</tr>
		{ if $gera_carne }
		<tr>
				<td align="center"><a href="" class="lista">Impressão do Carnê</a></td>
		</tr>
		{/if}
</table>

{/if}


{if $acao == "novo_contrato"}
<table class="lista" border=0 cellspacing=0 cellpadding=0 align="center" width="680" style="border: solid 1px #FF0000;">
{if $erro}
<tr>
	<td align="center" style="border-bottom: solid 1px #FF0000;"><span style="font-size: 14px"><strong>{$erro}</strong></span></td>
</tr>
{/if}
<tr>
	<td align="center" style="border-bottom: solid 1px #FF0000;"><span style="color: #FF0000;"><strong>-- {if $id_cliente_produto}MIGRAÇÃO{else}NOVO CONTRATO{/if} --</strong></span></td>
</tr>
<tr>
	<td align="center">
	<br>
	<!-- CONFIRMAÇÃO DO CONTRATO -->
	{foreach from=$form_post key=name item=value}
	<input type="hidden" name="{$name}" id="{$name}" value="{$value}" />
	{/foreach}
	<input type="hidden" name="id_cliente_produto" id="id_cliente_produto" value="{$id_cliente_produto}" />

	<input type="hidden" name="endereco_cobranca" value="{$endereco_cobranca}">
	<input type="hidden" name="endereco_instalacao" value="{$endereco_instalacao}">
	<input type="hidden" name="bairro_cobranca" value="{$bairro_cobranca}">
	<input type="hidden" name="bairro_instalacao" value="{$bairro_instalacao}">
	<input type="hidden" name="cep_cobranca" value="{$cep_cobranca}">
	<input type="hidden" name="cep_instalacao" value="{$cep_instalacao}">
	<input type="hidden" name="complemento_cobranca" value="{$complemento_cobranca}">
	<input type="hidden" name="complemento_instalacao" value="{$complemento_instalacao}">
	<input type="hidden" name="id_cidade_cobranca" value="{$id_cidade_cobranca}">
	<input type="hidden" name="id_cidade_instalacao" value="{$id_cidade_instalacao}">
	<input type="hidden" name="id_condominio_cobranca" value="{$id_condominio_cobranca}">
	<input type="hidden" name="id_condominio_instalacao" value="{$id_condominio_instalacao}">
	<input type="hidden" name="id_bloco_cobranca" value="{$id_bloco_cobranca}">
	<input type="hidden" name="id_bloco_instalacao" value="{$id_bloco_instalacao}">


	<table class="lista" border=0 cellspacing=0 cellpadding=0 width="650" align="center">
		<tr>
			<th colspan=4>Contratante - Cobran&ccedil;a</th>
		</tr>
		<tr>
			<td width="120" align="right"><strong>{if $cliente.tipo_pessoa == "F"}Nome{else}Razão Social{/if}:</strong></td>
			<td colspan=4>{$cliente.nome_razao}</td>
		</tr>
		<tr>
			<td width="120" align="right"><strong>{if $cliente.tipo_pessoa == "F"}CPF:{else}CNPJ:{/if}</strong></td>
			<td>{$cliente.cpf_cnpj}&nbsp;</td>
			<td width="120" align="right"><strong>{if $cliente.tipo_pessoa == "F"}RG:{else}Inscrição{/if}</strong></td>
			<td>{$cliente.rg_inscr}&nbsp;</td>
		</tr>
		<tr>
			<td width="120" align="right"><strong>Endereço:</strong></td>
			<td>{$endereco_cobranca}&nbsp;</td>

			<td width="120" align="right"><strong>Complemento:</strong></td>
			<td>{$complemento_cobranca}&nbsp;</td>

		</tr>
		<tr>
			<td width="120" align="right"><strong>Bairro:</strong></td>
			<td>{$bairro_cobranca}&nbsp;&nbsp;&nbsp;<strong>CEP:</strong>&nbsp;{$bairro_cobranca}</td>

			<td width="120" align="right"><strong>Cidade:</strong></td>
			<td>{$cidade_cobranca.cidade}-{$cidade_cobranca.uf}&nbsp;</td>

		</tr>
	</table>

	{if !$id_cliente_produto}

		{if $tipo!= "H" }
		   <br>
		<table class="lista" border=0 cellspacing=0 cellpadding=0 width="650" align="center">
			<tr>
				<th colspan=4>Contratante - Instala&ccedil;&atilde;o</th>
			</tr>
			<tr>
				<td width="120" align="right"><strong>Endereço:</strong></td>
				<td>{$endereco_instalacao}&nbsp;</td>

				<td width="120" align="right"><strong>Complemento:</strong></td>
				<td>{$complemento_instalacao}&nbsp;</td>

			</tr>
			<tr>
				<td width="120" align="right"><strong>Bairro:</strong></td>
				<td>{$bairro_instalacao}&nbsp;&nbsp;&nbsp;<strong>CEP:</strong>&nbsp;{$bairro_instalacao}</td>

		  <td width="120" align="right"><strong>Cidade:</strong></td>
				<td>{$cidade_instalacao.cidade}-{$cidade_instalacao.uf}&nbsp;</td>

			</tr>
		</table>
		{/if}

	{/if}

	{if $id_cliente_produto}


	<br>
	<table class="lista" border=0 cellspacing=0 cellpadding=0 width="650" align="center">
		<tr>
			<th colspan=6>Contrato Atual</th>
		</tr>
		<tr>
			<td width="120" align="right"><strong>Tipo:</strong></td>
			<td>{if $contrato.tipo_produto == "BL"}BANDA LARGA{/if}{if $contrato.tipo_produto == "D"}DISCADO{/if}{if $contrato.tipo_produto == "H"}HOSPEDAGEM{/if}</td>
			<td width="120" align="right"><strong>Produto:</strong></td>
			<td>{$contrato.nome_produto}&nbsp;</td>
			<td width="120" align="right"><strong>Valor:</strong></td>
			<td>{if $contrato.valor_produto > 0}{$contrato.valor_produto|string_format:"%.2f"}{else}cortesia{/if}</td>
		</tr>
		{if $contrato.valor_produto}
		<tr>
			<td width="120" align="right"><strong>Comodato:</strong></td>
			<td>{$contrato.valor_comodato|string_format:"%.2f"}&nbsp;</td>
			<td width="120" align="right"><strong>Tx Instalação:</strong></td>
			<td>{$contrato.tx_instalacao|string_format:"%.2f"}</td>
			<td width="120" align="right"><strong></strong></td>
			<td></td>

		</tr>
		<tr>
			<td width="120" align="right"><strong>Desconto:</strong></td>
			<td>{$contrato.desconto_promo|string_format:"%.2f"}&nbsp;</td>
			<td width="120" align="right"><strong>Período Desconto:</strong></td>
			<td>{$contrato.periodo_desconto} meses</td>
			<td width="120" align="right"><strong>Data Contratação:</strong></td>
			<td>{$contrato.data_contratacao}</td>
		</tr>
		<tr>
			<td width="120" align="right"><strong>Dia Vencimento:</strong></td>
			<td>{$contrato.vencimento}&nbsp;</td>
			<td width="120" align="right"><strong>Vigência:</strong></td>
			<td>{$contrato.vigencia} meses</td>
			<td width="120" align="right"><strong>Carência:</strong></td>
			<td>{$contrato.carencia} dias</td>
		</tr>
		<tr>
			<td width="120" align="right"><strong>Pagamento:</strong></td>
			<td>{if $contrato.pagamento == "PRE"}Pré Pago{else}Pós Pago{/if}</td>
 			<td width="120" align="right"><strong>Forma Pgto:</strong></td>
			<td><span style="font-family: arial; font-size: 9px;">{if $forma_pagamento_original == "PC" || $forma_pagamento_original == "DA" || $forma_pagamento_original == "BL"}{$tiposFormaPgto[$forma_pagamento_original]} {$bancos[$fp_original.codigo_banco]} - convênio {$fp_original.convenio}{else}Sistema manual com exportação.{/if}</span></td>
  		</tr>
		{if $forma_pagamento_original == "DA"}
		<tr>
			<td width="120" align="right"><strong>Banco:</strong></td>
			<td>{$fp_original.codigo_banco|string_format:"%03d"}</td>
			<td width="120" align="right"><strong>Agencia:</strong></td>
			<td>{$contrato.da_agencia}</td>
			<td width="120" align="right"><strong>Conta:</strong></td>
			<td>{$contrato.da_num_conta}</td>
		</tr>
		{/if}
		{/if}
	</table>


	{/if}

	<br>
	<table class="lista" border=0 cellspacing=0 cellpadding=0 width="650" align="center">
		<tr>
			<th colspan=6>Novo Contrato</th>
		</tr>
		<tr>
			<td width="120" align="right"><strong>Tipo:</strong></td>

			<td>{if $tipo == "BL"}BANDA LARGA{/if}{if $tipo == "D"}DISCADO{/if}{if $tipo == "H"}HOSPEDAGEM{/if}</td>
			<td width="120" align="right"><strong>Produto:</strong></td>
			<td>{$produto.nome}&nbsp;</td>
			<td width="120" align="right"><strong>Valor:</strong></td>
			<td>{if $produto.valor > 0}{$produto.valor|string_format:"%.2f"}{else}cortesia{/if}</td>
		</tr>
		{if $produto.valor > 0}
		<tr>
			<td width="120" align="right"><strong>Comodato:</strong></td>
			<td>{$valor_comodato|string_format:"%.2f"}&nbsp;</td>

			<td width="120" align="right"><strong>Tx Instalação:</strong></td>
			<td>{$tx_instalacao|string_format:"%.2f"}</td>

			<td width="120" align="right"><strong>Parcelas Inst.:</strong></td>
			<td>{if $parcelas_instalacao}{$parcelas_instalacao} ({$tx_instalacao/$parcelas_instalacao|string_format:"%.2f"}){else}N/A{/if}</td>

		</tr>
		<tr>
			<td width="120" align="right"><strong>Desconto:</strong></td>
			<td>{$desconto_promo|string_format:"%.2f"}&nbsp;</td>

			<td width="120" align="right"><strong>Período Desconto:</strong></td>
			<td>{$periodo_desconto} meses</td>

			<td width="120" align="right"><strong>Data Contratação:</strong></td>
			<td>{$data_contratacao}</td>

		</tr>
		<tr>
			<td width="120" align="right"><strong>Dia Vencimento:</strong></td>
			<td>{$dia_vencimento}&nbsp;</td>

			<td width="120" align="right"><strong>Vigência:</strong></td>
			<td>{if $vigencia > 0}{$vigencia} meses{else}<span style="font-family: arial; font-size: 9px;">Tempo Indeterminado</span>{/if}</td>

			<td width="120" align="right"><strong>Carência:</strong></td>
			<td>{$carencia} dias</td>

		</tr>
		<tr>
			<td width="120" align="right"><strong>Pagamento:</strong></td>
			<td>{if $pagamento == "PRE"}Pré Pago{else}Pós Pago{/if}</td>

 			<td width="120" align="right"><strong>Forma Pgto:</strong></td>
			<td><span style="font-family: arial; font-size: 9px;">{if $forma_pagamento == "PC" || $forma_pagamento == "DA" || $forma_pagamento == "BL"}{$tiposFormaPgto[$forma_pagamento]} {$bancos[$formaPagamento.codigo_banco]} - convênio {$formaPagamento.convenio}{else}{if $forma_pagamento=='NA'}Não Atribuida{else}Sistema manual com exportação.{/if}{/if}</span></td>
      <td width="120" align="right"><strong>Pr&oacute;xima Fatura:</strong></td>
			<td>{$primeiro_vencimento}</td>
  	</tr>
		{if $forma_pagamento == "DA"}
		<tr>
			<td width="120" align="right"><strong>Banco:</strong></td>
			<td>{$formaPagamento.codigo_banco|string_format:"%03d"}</td>

			<td width="120" align="right"><strong>Agencia:</strong></td>
			<td>{$agencia}</td>

			<td width="120" align="right"><strong>Conta:</strong></td>
			<td>{$conta}</td>
		</tr>
		{/if}
		{/if}
	</table>

{if $id_cliente_produto}
	<br>
	<table class="lista" border=0 cellspacing=0 cellpadding=0 width="650" align="center">
		<tr>
			<th colspan=6>Contas que serão migradas</th>
		</tr>
		{foreach name=registros item=c from=$listaContas}
		<tr>
			<td><label>&nbsp; {$c.username}{if $c.tipo_conta == "E"}@{$c.dominio}{/if}</label></td>
			<td><label>{if $c.tipo_conta == 'BL'}Banda Larga{elseif $c.tipo_conta == 'E'}Email{elseif $c.tipo_conta=='H'}Hospedagem{elseif $tipo_conta == 'D'}Discado{/if}</label></td>
			<td><label>{if $c.status == "A"}Ativa{elseif $c.status == "B"}Bloqueado{elseif $c.status == "S"}Suspenso{elseif $c.status == "C"}Cancelado{/if}</label></td>
		</tr>

		{/foreach}
	</table>


{else}

	<br>
	<table class="lista" border=0 cellspacing=0 cellpadding=0 width="650" align="center">
		<tr>
			<th colspan=6>Detalhes da Conta</th>
		</tr>
		<tr>
			<!--td width="120" align="right"><strong>Tipo:</strong></td>
			<td>{if $tipo == "BL"}Banda Larga{/if}{if $tipo == "D"}Discado{/if}{if $tipo == "H"}Hospedagem{/if}</td-->
			<td width="120" align="right"><strong>Username:</strong></td>
			<td>{$username}</td>

			<td width="120" align="right"><strong>Criar e-mail:</strong></td>
			<td>{if $criar_email == "t"}{$username}@{$preferenciasGerais.dominio_padrao}{else}NÃO{/if}</td>
		</tr>
		{if $tipo == "BL"}
		<tr>
			<td width="120" align="right"><strong>Upload:</strong></td>
			<td>{$produto.banda_upload_kbps} kbps</td>

			<td width="120" align="right"><strong>Download:</strong></td>
			<td>{$produto.banda_download_kbps} kbps</td>
		</tr>
		<tr>
			<td width="120" align="right"><strong>NAS:</strong></td>
			<td>{$nas.nome} ({$tiposNAS[$nas.tipo_nas]})</td>

			<td width="120" align="right"><strong>POP:</strong></td>
			<td>{$pop.nome}</td>

		</tr>
		<tr>
			<td width="120" align="right"><strong>Rede/IP:</strong></td>
			<td>{if $selecao_redeip=="A"}Automática{else}{$endereco_redeip}{/if}</td>

			<td width="120" align="right"><strong>MAC:</strong></td>
			<td>{if $mac}{$mac}{else}Não Informado{/if}</td>

		</tr>
		{/if}

    {if $tipo == "D"}
    <tr>
			<td width="120" align="right"><strong>Fone:</strong></td>
			<td colspan=4>{$foneinfo}</td>

		</tr>
		{/if}

		{if $tipo == "H"}
    <tr>
			<td width="120" align="right"><strong>Tipo:</strong></td>
			<td >{if $tipo_hospedagem == "D"}Dom&iacute;nio do Usu&aacute;rio{else}www.{$preferenciasGerais.dominio_padrao}/usuario/username{/if}</td>

      <td width="120" align="right"><strong>Criar Dominio:</strong></td>
			<td>www.{$dominio_hospedagem}</td>

		</tr>
		{/if}


	</table>
{/if}
	<br />
	<table class='lista' width='650' cellpadding=0 cellspacing=0 align="center" style="border: solid 1px #000000;">
		<tr>
			<th colspan=2 style="border-right: solid 2px #000000;">faturas</th>
			<th colspan={if $id_cliente_produto}6{else}5{/if}>composição dos valores</th>
		</tr>
		<tr>
			<td bgcolor="#f0f0f0" align="center" style="border-right: solid 1px #000000; border-bottom: solid 1px #000000;">Data</td>
			<td bgcolor="#f0f0f0" align="center" style="border-right: solid 2px #000000; border-bottom: solid 1px #000000;">Valor(=)</td>
			<td bgcolor="#f0f0f0" align="center" style="border-right: solid 1px #000000; border-bottom: solid 1px #000000;">Plano(+)</td>
			{if $id_cliente_produto}
			<td bgcolor="#f0f0f0" align="center" style="border-right: solid 1px #000000; border-bottom: solid 1px #000000;">Residual *</td>
			{/if}
			<td bgcolor="#f0f0f0" align="center" style="border-right: solid 1px #000000; border-bottom: solid 1px #000000;">Comodato(+) **</td>
			<td bgcolor="#f0f0f0" align="center" style="border-right: solid 1px #000000; border-bottom: solid 1px #000000;">Pró-Rata ***</td>
			<td bgcolor="#f0f0f0" align="center" style="border-right: solid 1px #000000; border-bottom: solid 1px #000000;">Desconto(-)</td>
			<td bgcolor="#f0f0f0" align="center" style="border-bottom: solid 1px #000000;">Tx. Instalação(+)</td>
		</tr>
	{if $produto.valor > 0}
		<!-- FATURAS QUE SERAO CADASTRADAS -->


			{foreach name=registros item=f from=$faturas}
			{if ($smarty.foreach.registros.iteration%2) }{assign var=estilo value='par'}{else}{assign var=estilo value='impar'}{/if}
			<tr>
				<td class='{$estilo}' aling="center" style="border-right: solid 1px #000000;">{$f.data|date_format:"%d/%m/%Y"}</td>
				<td class='{$estilo}' align="right" style="border-right: solid 2px #000000;">{$f.valor|string_format:"%.2f"}</td>
				<!-- COMPOSICAO DE VALORES -->
				<td class='{$estilo}' align="right" style="border-right: solid 1px #000000;">
				   {if $f.composicao.valor}
				      {$f.composicao.valor|string_format:"%.2f"}
				   {else}
				      -
				   {/if}
				</td>
				{if $id_cliente_produto}
				<td class='{$estilo}' align="right" style="border-right: solid 1px #000000;">
				   {if $f.composicao.residual.prorata_residual}
				      {$f.composicao.residual.prorata_residual|string_format:"%.2f"}{else}-{/if}</td>
				{/if}
				<td class='{$estilo}' align="right" style="border-right: solid 1px #000000;">
				{if $f.composicao.prorata_comodato}
				   {$f.composicao.prorata_comodato|string_format:"%.2f"}
				{else}
				   {if $f.composicao.comodato}
				      {$f.composicao.comodato|string_format:"%.2f"}
				   {else}
				      -
				   {/if}
				{/if}
				</td>
				<td class='{$estilo}' align="right" style="border-right: solid 1px #000000;">{if $f.composicao.dias_prorata}R$ {$f.composicao.prorata_plano|string_format:"%.2f"} ({$f.composicao.dias_prorata} dias){else}-{/if}</td>
				<td class='{$estilo}' align="right" style="border-right: solid 1px #000000;">{if $f.composicao.desconto.valor}{$f.composicao.desconto.parcela}: {$f.composicao.desconto.valor|string_format:"%.2f"}{else}-{/if}</td>
				<td class='{$estilo}' align="right">{if $f.composicao.instalacao}{$f.composicao.parcela_instalacao}: {$f.composicao.instalacao|string_format:"%.2f"}{else}-{/if}</td>
			</tr>
			{/foreach}
			<tr>
				<td colspan="{if $id_cliente_produto}8{else}7{/if}">
				{if $id_cliente_produto}
				* Valor residual calculado com base na pro-rata do contrato antigo.<br>
				{/if}
				** Cálculos de pro-rata aplicados ao valor do comodato.<br>
				*** Valores negativos indicam desconto.<br>
				</td>

	{else}
		<tr>
			<td colspan="7" class='{$estilo}' align="center" style="border-right: solid 2px #000000;"><br /><span style=" color:red; font-weight: bold;">*** Contrato cortesia faturamento não aplicável ***</span><br /><br /> </td>
			<!-- COMPOSICAO DE VALORES>
			<td class='{$estilo}' align="center" style="border-right: solid 1px #000000;">*</td>
			<td class='{$estilo}' align="center" style="border-right: solid 1px #000000;">*</td>
			<td class='{$estilo}' align="center" style="border-right: solid 1px #000000;">*</td>
			<td class='{$estilo}' align="center" style="border-right: solid 1px #000000;">*</td>
			<td class='{$estilo}' align="center">*</td-->
		</tr>
	{/if}
	</table>
	<br />
</td>
</tr>
</table>
<br>
<table width="630" class="lista" cellpadding=0 cellspacing=0 align="center">
	<tr>
		<th style="background: #FF0000; color: #ffffff" colspan=2>Confirmação</th>
	</tr>
	<tr>
		<td align="right">Administrador: </td><td><label><strong>{$dadosLogin.admin}</strong></label></td>
	</tr>
	<tr>
		<td align="right">Confirme sua senha: </td><td><input type="password" name="senha_admin" id="senha_admin" class="fieldWithoutFocus" onFocus="javascript:formOnFocus(this)" onBlur="javascript:formOnBlur(this)"><input type="submit" class="botao" name="submit" id="submit" value="{if $id_cliente_produto}Migrar Contrato{else}Gravar Contrato{/if}"></td>
	</tr>

</table>
<br>

{/if}

<script>

{if !$acao == "gravar_novo_contrato"}
	AlimentarCombo('id_condominio_cobranca', condominios, 'id_condominio', 'nome', '--SELECIONE--' {if $id_condominio}, '', '{$id_condominio}'{/if});
	AlimentarCombo('id_condominio_instalacao', condominios_instalacao, 'id_condominio', 'nome', '--SELECIONE--' {if $id_condominio}, '', '{$id_condominio}'{/if});

	{if $tela == "migrar" || $tela == "novo_contrato"}
		{if $id_condominio}

			AjustarCamposFormularioContratoCobranca('contratacao', document.getElementById('id_condominio_cobranca').selectedIndex -1 , condominios);

			{if $id_bloco}
				AtualizaComboBloco('id_bloco_cobranca', '{$id_condominio}', '{$id_bloco}');
			{/if}
			document.getElementById('id_bloco_cobranca').disabled = true;
			document.getElementById('apto_cobranca').disabled = true;

		{/if}

	{/if}
{/if}

</script>
